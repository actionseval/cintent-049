name: ðŸ–¥ï¸ Unit test CLI

# CINTENT >> MANUAL_TRIGGER
# on:
#   pull_request:
#     branches:
#       - develop
#     paths:
#       - 'cli/**'
on: [repository_dispatch, workflow_dispatch]

concurrency:
    group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.sha }}
    cancel-in-progress: true

jobs:
  unit_tests:
    runs-on: ubuntu-latest
    strategy:
        fail-fast: false

        matrix:
          # CINTENT >> REMOVE_MATRIX
          # python_version: ["3.9", "3.10", "3.11", "3.12", "3.13"]
          python_version: ["3.13"]
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        # with:
        #   ref: ${{ github.event.pull_request.head.sha }}

      - name: Install Python ${{ matrix.python_version }}
        uses: actions/setup-python@v5
        with:
            python-version: ${{ matrix.python_version }}
            # allow-prereleases: true
            # cache: "pip"

      # - name: Cache pip packages
      #   uses: actions/cache@v4
      #   with:
      #     path: ~/.cache/pip
      #     key: ${{ runner.os }}-pip-${{ matrix.python-version }}-${{ hashFiles('cli/poetry.lock') }}
      #     restore-keys: |
      #       ${{ runner.os }}-pip-

      # CINTENT >> INSERT_CINTENT
      - uses: JavidDitty/setup-cintent@3638849e94bdb037f0a405375686a8550e6df904
        with:
          nonblocking: true

      - name: Run tests
        run: |
          pip install nox
          nox -f .github/scripts/noxfile.py -s unit_test_cli --python ${{ matrix.python_version }}

      # CINTENT >> INSERT_CINTENT
      - name: Upload CIntent Artifacts
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ${{ env.CINTENT_ARTIFACT_NAME }}
          path: ${{ env.CINTENT_LOGS }}
